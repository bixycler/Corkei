import"../../../../../shared/modulepreload-polyfill-B5Qt9EMX.js";import g from"https://cdnjs.cloudflare.com/ajax/libs/two.js/0.8.0/two.module.js";import{s as M}from"../../../../../shared/artifacts/applets/FABRIK/window-message-channel-CXnbUf7V.js";const z=twoCanvas,a=new g({fullscreen:!1,type:g.Types.svg,width:600,height:600,autostart:!0}).appendTo(z),u=a.renderer.domElement,w=20,h=new g.Vector(a.width/4,a.height/2),C=a.width/2;let x=numSegs.value,E=C/x;const F=a.makeRectangle(h.x,h.y,w,w);F.fill="blue";F.noStroke();const m=a.makeCircle(h.x+C,h.y,w/2);m.fill="blue";m.stroke="red";m.linewidth=2;const o=[],L=[],r=[],k=[],n=a.makePath(o,!0);n.stroke="Gray";n.linewidth=4;n.noFill();n.visible=shadow.checked;const c=a.makePath(o,!0);c.stroke="DodgerBlue";c.linewidth=4;c.noFill();let b=!1;const l=[];function D(i){for(x=i,E=C/x;o.length;)o.pop(),L.pop().remove(),c.vertices.pop(),r.pop(),k.pop().remove(),n.vertices.pop(),l.pop().remove();m.position.set(h.x+C,h.y,w/2),n.visible=shadow.checked;for(let e=0;e<=x;e++){let t=a.makeCircle(h.x+e*E,h.y,w/4);t.fill="Black",t.noStroke(),t.visible=shadow.checked,k.push(t),r.push(t.position);let p=new g.Anchor(t.position.x,t.position.y);n.vertices.push(p);let d=a.makeCircle(t.position.x,t.position.y,w/4);d.fill="cyan",d.noStroke(),L.push(d),o.push(d.position);let y=new g.Anchor(d.position.x,d.position.y);c.vertices.push(y);let s=a.makePath([p.clone(),y.clone()],!0);s.stroke="Gray",s.linewidth=2,s.noFill(),s.dashes=[4],s.visible=shadow.checked,e==x&&(s.stroke="DimGray"),l.push(s)}}D(numSegs.value);numSegs.addEventListener("change",i=>{D(numSegs.value)});shadow.addEventListener("change",i=>{n.visible=shadow.checked;for(let e in o)k[e].visible=l[e].visible=shadow.checked});function I(i,e){o[o.length-1].set(i.x,i.y);for(let t=o.length-2;t>=0;t--){let p=o[t+1].x-r[t].x,d=o[t+1].y-r[t].y,y=Math.hypot(p,d),s=E/y;o[t].set((1-s)*o[t+1].x+s*r[t].x,(1-s)*o[t+1].y+s*r[t].y)}if(e){o[0].set(h.x,h.y);for(let t=1;t<o.length;t++){let p=o[t-1].x-o[t].x,d=o[t-1].y-o[t].y,y=Math.hypot(p,d),s=E/y;o[t].set((1-s)*o[t-1].x+s*o[t].x,(1-s)*o[t-1].y+s*o[t].y)}}}function S(i){if(!b)for(let e in o)r[e].copy(o[e]),n.vertices[e].x=r[e].x-n.position.x,n.vertices[e].y=r[e].y-n.position.y,l[e].vertices[0].x=r[e].x-l[e].position.x,l[e].vertices[0].y=r[e].y-l[e].position.y;if(i){if(!b){b=!0,n.visible=!0;for(let e in o)k[e].visible=l[e].visible=!0;console.log("Hold: ("+r.join("); (")+")")}}else if(b&&(b=!1,!shadow.checked)){n.visible=!1;for(let e in o)k[e].visible=l[e].visible=!1}if(f){I(m.position,fixedBase.checked);for(let e in c.vertices)c.vertices[e].x=o[e].x-c.position.x,c.vertices[e].y=o[e].y-c.position.y,l[e].vertices[1].x=o[e].x-l[e].position.x,l[e].vertices[1].y=o[e].y-l[e].position.y}}const K=new XMLSerializer;saveImage.addEventListener("click",i=>{let e=(fixedBase.checked?"-fixedBase":"")+(shadow.checked?"-sahdow":"");downloadImage.download=`FabrikDemo-${x}-${targetCoords.value.replace(" ","")}${e}.svg`;const t=K.serializeToString(u);downloadImage.href="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(t),downloadImage.click()});targetCoords.addEventListener("change",i=>{T(!0,!1);let e=f;f=!0,S(!1),f=e});const v=new g.Vector;let f=!1;function B(i){f=!1,u.removeEventListener("mousemove",j),u.removeEventListener("mouseup",B)}function R(i){let e=u.getBoundingClientRect();v.set(i.clientX,i.clientY);let t=e;f=v.x>t.left&&v.x<t.right&&v.y>t.top&&v.y<t.bottom,T(fixedTarget.checked,f),u.addEventListener("mousemove",j),u.addEventListener("mouseup",B),S(i.ctrlKey)}function j(i){v.set(i.clientX,i.clientY),T(fixedTarget.checked,f),S(i.ctrlKey)}function T(i,e){let t=u.getBoundingClientRect();if(i){const p=targetCoords.value.split(",");m.position.set(p[0],p[1])}else e&&m.position.set(Math.round(v.x-t.x),Math.round(v.y-t.y)),targetCoords.value=m.position}u.addEventListener("mouseup",B);u.addEventListener("mousedown",R);u.addEventListener("mousemove",j);function G(){return{get name(){return"FabrikDemo"},two:a,mouse:v,joints:o,jointNodes:L,line:c,ojoints:r,ojointNodes:k,oline:n,projs:l,Two:g,fabrik:I}}Object.assign(globalThis,{FabrikDemo:G});M(Explanation,FabrikExplanation);
