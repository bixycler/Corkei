import"../../../../shared/modulepreload-polyfill-B5Qt9EMX.js";const j=[];function E(n,...p){const w=p.map(r=>{if(typeof r=="object"&&r!==null)try{return`[Object ${r.constructor?.name||""}]`}catch{return"[Object]"}return String(r)}).join(" "),e={level:n,text:w};j.push(e),q(),n==="info"?console.info(...p):n==="warn"?console.warn(...p):n==="error"?console.error(...p):console.debug(...p)}const P={debug:(...n)=>E("debug",...n),info:(...n)=>E("info",...n),warn:(...n)=>E("warn",...n),error:(...n)=>E("error",...n)};function M(n){const p=document.getElementById("file-status");p&&(p.textContent=n?`Current File: ${n}`:"")}function q(){const n=document.getElementById("messages-root");if(!n)return;const p=j.filter(e=>e.level!=="debug");if(p.length===0){n.style.display="none";return}n.style.display="block",n.innerHTML="";const w=L("System Messages",n,!0,!1,"",null,"",!1);for(const[e,r]of p.entries()){const t=document.createElement("div");t.className=`msg-group msg-${r.level}`;const c=document.createElement("div");c.className="msg-header",c.innerHTML=`<span>[${r.level.toUpperCase()}] Message #${Number(e)+1}</span><span class="arrow"></span>`;const s=document.createElement("div");s.className="msg-content",s.textContent=r.text,r.level==="info"&&(s.classList.add("folded"),c.classList.add("folded")),c.onclick=()=>{s.classList.toggle("folded"),c.classList.toggle("folded")},t.appendChild(c),t.appendChild(s),w.appendChild(t)}}function v(n){return new Intl.NumberFormat().format(n)}function z(n){return n.length>23?n.substring(0,10)+"..."+n.substring(n.length-10):n}async function K(){const n=document.getElementById("json-file"),p=await fetch("test.json");if(p.ok){const w=await p.json();M("test.json"),G(w)}else console.debug(`Optional test.json not found (Status: ${p.status})`);n.addEventListener("change",w=>{const e=w.target.files?.[0];if(!e)return;const r=new FileReader;r.onload=t=>{try{j.length=0,M(e.name);const c=t.target?.result;if(typeof c=="string"){const s=JSON.parse(c);G(s)}}catch(c){P.error("Failed to parse JSON file:",c)}},r.readAsText(e)})}function G(n){const p=document.getElementById("gui-root");if(p.innerHTML="",!n?.CatalogProductOfferingsResponse?.CatalogProductOfferings?.CatalogProductOffering){P.error("Invalid Travelport JSON structure."),p.innerHTML='<div class="error-box">Invalid Travelport JSON structure.</div>';return}window.TravelportResponse=JSON.parse(JSON.stringify(n)),window.TravelportOffers=n.CatalogProductOfferingsResponse.CatalogProductOfferings.CatalogProductOffering,window.TravelportReferenceList=n.CatalogProductOfferingsResponse.ReferenceList,window.TravelportOfferCombos=[],window.TravelportPriceCombos={},window.TravelportCombos={},window.TravelportProducts={},window.TravelportRefProducts={},window.TravelportRefFlights={};for(let e of window.TravelportReferenceList){if(e["@type"]==="ReferenceListProduct")for(let r of e.Product)window.TravelportRefProducts[r.id]=r;if(e["@type"]==="ReferenceListFlight")for(let r of e.Flight)window.TravelportRefFlights[r.id]=r}for(let e of Object.values(window.TravelportRefProducts))if(e.FlightSegment)for(let r of e.FlightSegment)r.flight=window.TravelportRefFlights[r.Flight.FlightRef];for(let[e,r]of window.TravelportOffers.entries())r.position=e+1,r.id=`${r.position}:${r.id}`;for(let e of window.TravelportOffers){if(!e.ProductBrandOptions){P.warn("Skipping offer without ProductBrandOptions:",e),e.skip=!0;continue}let r=e.sequence;if(r===1){let t=window.TravelportOfferCombos.length+1,c={position:t,id:`oc${t}:${e.id}`,legs:[],options:[],ContentSource:null};window.TravelportOfferCombos.push(c)}for(let[t,c]of e.ProductBrandOptions.entries()){c.offer=e;const s=Array.isArray(c.ProductBrandOffering)?c.ProductBrandOffering:Object.values(c.ProductBrandOffering);for(let[u,o]of s.entries()){o.option=c;let l=o.Product[0].productRef;o.Product.length>1&&P.info("Product has more than 1 ID:",o.Product),o.product=window.TravelportRefProducts[l],o.position=`${e.position}:${t+1}:${u+1}`,o.id=`${o.position}:${l}`,window.TravelportProducts[o.id]=o,delete e["@type"],delete c["@type"],delete o["@type"],o.BestCombinablePrice.TotalPrice?.["@type"]&&delete o.BestCombinablePrice.TotalPrice["@type"],delete o.TermsAndConditions;let a=o.CombinabilityCode,g=a.join(" "),C=o.BestCombinablePrice.TotalPrice,f=null;if(g in window.TravelportPriceCombos?(f=window.TravelportPriceCombos[g],C!==f.price&&P.error(`Different TotalPrice for pcc = ${g}: `,`product = ${C}`,a,` <> combo = ${f.price}`,f.CombinabilityCode),JSON.stringify(o.BestCombinablePrice)!==JSON.stringify(f.BestCombinablePrice)&&P.info(`Different BestCombinablePrice for pcc = ${g}: `,"product = ",o.BestCombinablePrice," <> combo =",f.BestCombinablePrice)):(f={price:C,currency:o.BestCombinablePrice.CurrencyCode.value||o.BestCombinablePrice.CurrencyCode,BestCombinablePrice:o.BestCombinablePrice,CombinabilityCode:a,priceCC:g,offerCombo:null,combos:[],totalComboCount:0},window.TravelportPriceCombos[g]=f,P.debug("New priceCombo:",f,`at product[${l}]`,o)),r===1){let b=window.TravelportOfferCombos.at(-1);b.ContentSource||(b.ContentSource=o.ContentSource);let m=o.ContentSource==="NDC"?t:0,$=b.options[m]??(b.options[m]=[]);$.includes(f)||$.push(f)}for(let b of a){let m=null;b in window.TravelportCombos?(m=window.TravelportCombos[b],m.priceCombos.includes(f)||m.priceCombos.push(f),m.priceCombos.length>1&&C!==m.priceCombos[0].price&&P.error(`Different TotalPrice for cc = ${b}: `,`product = ${C}`,a,` <> combo = ${m.priceCombos[0].price}`,m.priceCombos[0].CombinabilityCode),JSON.stringify(o.BestCombinablePrice)!==JSON.stringify(m.BestCombinablePrice)&&P.info(`Different BestCombinablePrice for cc = ${b}: `,"product = ",o.BestCombinablePrice," <> combo =",m.BestCombinablePrice)):(m={priceCombos:[f],BestCombinablePrice:o.BestCombinablePrice,CombinabilityCode:a,cc:b,legs:[],comboCount:0},window.TravelportCombos[b]=m),(m.legs[r-1]??(m.legs[r-1]=[])).push(o)}}}}for(let e of Object.values(window.TravelportCombos))e.comboCount=e.legs.reduce((r,t)=>r*(t?t.length:0),1);for(let e of Object.values(window.TravelportPriceCombos))for(let r of e.CombinabilityCode){let t=window.TravelportCombos[r];t?(e.combos.includes(t)||(e.combos.push(t),e.totalComboCount+=t.comboCount),t.priceCombos.includes(e)||t.priceCombos.push(e)):P.error(`Combo ${r} not found for priceCombo`,e)}for(let e of window.TravelportOfferCombos){e.comboCount=0;for(let r of e.options)if(r)for(let t of r){t.offerCombo=e,e.comboCount+=t.totalComboCount,t.legs=[];for(let c of t.combos)for(let[s,u]of c.legs.entries()){if(u.length<1){P.warn(`Empty leg #${parseInt(s)+1} in combo ${c.cc}`,c);continue}let o=null;for(let l of u)o?l.option.offer!==o&&P.error(`Different offers for the same leg #${parseInt(s)+1}: `,o,l.option.offer):o=l.option.offer;o&&(s in e.legs?Array.isArray(e.legs[s])?e.legs[s].includes(o)||e.legs[s].push(o):e.legs[s]!==o&&(e.legs[s]=[e.legs[s],o]):e.legs[s]=o,s in t.legs?Array.isArray(t.legs[s])?t.legs[s].includes(o)||t.legs[s].push(o):t.legs[s]!==o&&(t.legs[s]=[t.legs[s],o]):t.legs[s]=o)}}}window.TravelportPrices=Object.values(window.TravelportPriceCombos).filter(e=>e.offerCombo!=null),window.TravelportPrices.sort((e,r)=>e.price-r.price);for(let[e,r]of window.TravelportPrices.entries())r.priceCC=`${e+1}:${r.priceCC}`;V(p);const w=e=>(Array.isArray(e)?e:[e]).map(t=>t?`<b>${t.id}: ${t.Departure} → ${t.Arrival}</b>`:"(N/A)").join('<hr style="margin: 5px 0; border: none; border-top: 1px dashed #ccc;">');for(const[e,r]of window.TravelportOfferCombos.entries()){const t=[];for(const u of r.legs){const o=Array.isArray(u)?u:[u];for(const l of o)t.includes(l.id)||t.push(l.id)}const c=r.ContentSource==="GDS",s=L(`Offer Combo #${Number(e)+1} (${r.id}) [Leg IDs: ${t.join(", ")}]`,p,!1,c,"group-offer");for(const[u,o]of r.options.entries()){if(!o)continue;let l=s;if(r.ContentSource!=="GDS"){const a=r.ContentSource==="NDC";l=L(`Option #${Number(u)+1}`,s,!1,a)}for(const a of o){const g=document.createElement("table"),C=document.createElement("thead"),f=document.createElement("tr");f.innerHTML="<th>Combo CC<br><small>(Count)</small></th>";const b=r.legs.length;for(let d=0;d<b;d++){const T=document.createElement("th");T.innerHTML=`Leg ${d+1}<br><small>${w(a.legs[d])}</small>`,f.appendChild(T)}C.appendChild(f),g.appendChild(C);const m=document.createElement("tbody"),$=Q(a,r.ContentSource==="NDC",m,C),y=`<span class="price-highlight">${v(a.price)} ${a.currency}</span> <span class="combo-count">${v(a.totalComboCount)} combo(s)</span> (CC: ${z(a.priceCC)})`,h=`pc-${a.priceCC.split(":").join("-")}`,i=L(y,l,!0,!1,"",$,h);for(const d of a.combos){const T=document.createElement("tr");T.innerHTML=`<td><span class="cc-code" title="${d.cc}">${d.cc}</span><br><div style="margin-top: 5px;"></div><span class="combo-count">(${v(d.comboCount)})</span></td>`;for(let N=0;N<b;N++){const F=document.createElement("td"),I=d.legs[N]||[];if(I.length>0){const A=document.createElement("ul");A.className="product-list";for(const O of I){const D=document.createElement("li");D.className="product-item";const B=[];if(O.product?.FlightSegment)for(let S=0;S<O.product.FlightSegment.length;S++){const R=O.product.FlightSegment[S].flight;R&&(S===0&&B.push(R.Departure.location),B.push(R.Arrival.location))}const k=B.filter((S,x)=>x===0||S!==B[x-1]),J=k.length>0?k.join(" → "):O.option.offer.Departure+" → "+O.option.offer.Arrival;D.innerHTML=`
                  <span class="product-id">${O.Product[0].productRef}</span>
                  <span class="route-info">${J}</span>
                `,A.appendChild(D)}F.appendChild(A)}T.appendChild(F)}m.appendChild(T)}g.appendChild(m),i.appendChild(g)}}}}function Q(n,p,w,e){const r=n.legs.length,t=document.createElement("tr");t.className="overview-row",e.addEventListener("click",()=>{t.style.display=t.style.display==="none"?"":"none"});const c=document.createElement("td");c.style.border="none",c.innerHTML="Combination<br>Overview",t.appendChild(c);const s=[];for(let u=0;u<r;u++){const o=document.createElement("td");o.className="overview-cell",t.appendChild(o);const l=document.createElement("div");l.className="leg-stack",o.appendChild(l);const a={};s.push(a);const g=Array.isArray(n.legs[u])?n.legs[u]:[n.legs[u]];for(const C of g){const f=document.createElement("div");f.className="offer-box",f.title=`Offer ${C.id}`,l.appendChild(f);for(const b of C.ProductBrandOptions){const m=document.createElement("div");m.className="option-box",f.appendChild(m);const $=Array.isArray(b.ProductBrandOffering)?b.ProductBrandOffering:Object.values(b.ProductBrandOffering);for(const y of $){const h=document.createElement("div");h.className="product-box",h.title=`Product ${y.id}`,m.appendChild(h);for(const i of y.CombinabilityCode)if(n.CombinabilityCode.includes(i)){const d=document.createElement("div");d.className="cc-dot",d.title=`CC: ${i}`,h.appendChild(d);const T=`${y.position}:${i}`;a[T]=d}}}}}return w.appendChild(t),()=>{if(t.querySelector("svg"))return;const u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("class","overview-lines-svg"),t.appendChild(u);const o=t.getBoundingClientRect();if(o.width===0||o.height===0){P.warn("Cannot draw lines: overviewRow has no size. Is it visible?");return}for(const l of n.combos){const a=l.cc;for(let g=0;g<r-1;g++){const C=l.legs[g]||[],f=l.legs[g+1]||[];if(p){if(C.length>0&&f.length>0){const b=C[0],m=f[0],$=`${b.position}:${a}`,y=`${m.position}:${a}`,h=s[g][$],i=s[g+1][y];h&&i&&H(u,h,i,o)}}else for(const b of C)for(const m of f){const $=`${b.position}:${a}`,y=`${m.position}:${a}`,h=s[g][$],i=s[g+1][y];h&&i&&H(u,h,i,o)}}}}}function H(n,p,w,e){const r=p.getBoundingClientRect(),t=w.getBoundingClientRect(),c=r.left+r.width/2-e.left,s=r.top+r.height/2-e.top,u=t.left+t.width/2-e.left,o=t.top+t.height/2-e.top,l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",String(c)),l.setAttribute("y1",String(s)),l.setAttribute("x2",String(u)),l.setAttribute("y2",String(o)),l.setAttribute("stroke","#6f42c1"),l.setAttribute("stroke-width","1"),l.setAttribute("opacity","0.4"),n.appendChild(l)}function V(n){const p=document.createElement("div");p.id="summary-root";const w=document.createElement("span");w.className="summary-title",w.innerText="Search Results Summary",p.appendChild(w);const e=window.TravelportOfferCombos[0];let r="N/A";e&&e.legs.length>0&&(r=e.legs.map(i=>{const d=Array.isArray(i)?i[0]:i;return`${d.Departure}-${d.Arrival}`}).join(", ")+` (${e.legs.length} legs)`);const t=window.TravelportOffers.filter(i=>!i.skip),c=t.filter(i=>i.ProductBrandOptions?.some(d=>(Array.isArray(d.ProductBrandOffering)?d.ProductBrandOffering:Object.values(d.ProductBrandOffering)).some(N=>N.ContentSource==="NDC"))).length,s=t.length,u=t.length-c;let o=window.TravelportOfferCombos.length,l=window.TravelportOfferCombos.reduce((i,d)=>d.ContentSource==="GDS"?i+1:i,0),a=window.TravelportOfferCombos.reduce((i,d)=>d.ContentSource==="NDC"?i+1:i,0),g=window.TravelportPrices.length,C=window.TravelportPrices.reduce((i,d)=>d.offerCombo.ContentSource==="GDS"?i+1:i,0),f=window.TravelportPrices.reduce((i,d)=>d.offerCombo.ContentSource==="NDC"?i+1:i,0),b=0,m=0,$=0;for(const i of Object.values(window.TravelportOfferCombos))b+=i.comboCount,i.ContentSource==="NDC"?$+=i.comboCount:m+=i.comboCount;const y=document.createElement("div");y.className="summary-info",y.innerHTML=`
    <strong>Journey:</strong> ${r}<br>
    <strong>Offers:</strong> ${v(s)} (GDS: ${v(u)}, NDC: ${v(c)}) &emsp;
    <strong>Offer Combos:</strong> ${v(o)} (GDS: ${v(l)}, NDC: ${v(a)}) <br>
    <strong>Price Combos:</strong> ${v(g)} (GDS: ${v(C)}, NDC: ${v(f)}) &emsp;
    <strong>Total Combos:</strong> ${v(b)} (GDS: ${v(m)}, NDC: ${v($)})
  `,p.appendChild(y);const h=document.createElement("div");h.className="price-links";for(const i of window.TravelportPrices){const d=document.createElement("a");d.className="price-chip",d.href=`#pc-${i.priceCC.split(":").join("-")}`,d.innerText=`${v(i.price)} ${i.currency}`,h.appendChild(d)}p.appendChild(h),n.appendChild(p)}function L(n,p,w=!0,e=!1,r="",t=null,c="",s=!0){const u=document.createElement("div");u.className="group"+(r?" "+r:""),c&&(u.id=c);const o=document.createElement("div");o.className="group-header",o.innerHTML=`<span>${n}</span>`;const l=document.createElement("div");if(l.className="group-header-actions",s){const C=document.createElement("a");C.className="back-to-top",C.href="#",C.innerHTML="↑",C.title="Back to top",C.onclick=f=>{f.preventDefault(),f.stopPropagation(),window.scrollTo({top:0,behavior:"smooth"})},l.appendChild(C)}if(e)o.style.cursor="default";else{const C=document.createElement("span");C.className="arrow",l.appendChild(C),o.onclick=f=>{a.classList.toggle("folded"),o.classList.toggle("folded"),!a.classList.contains("folded")&&t&&t()}}o.appendChild(l);const a=document.createElement("div");a.className="group-content";const g=document.createElement("div");return g.className="group-transition-wrapper",a.appendChild(g),w&&!e?(a.classList.add("folded"),o.classList.add("folded")):!w&&t&&requestAnimationFrame(()=>t()),u.appendChild(o),u.appendChild(a),p.appendChild(u),g}K().catch(n=>{console.error("Top-level error in main():",n)});
