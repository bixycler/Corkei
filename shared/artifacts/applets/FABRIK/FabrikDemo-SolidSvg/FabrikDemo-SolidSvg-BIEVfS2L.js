import{e as F,j as te,h as ne,k as O,l as Q,o as W,b as K,t as T,n as z,i as A,m as V,d as D,s as k,u as J,c as P,S as oe,M as X,r as re}from"../../../../web-BS2tC4It.js";import{s as ie}from"../window-message-channel-CXnbUf7V.js";function I(r){return{x:r.x,y:r.y}}function se(r=10,l=300,m={x:150,y:300}){const[u,c]=F(r),[f,g]=F(l/r),[$,L]=F(I(m)),[S,x]=F([]),[B,p]=F([]);function v(a,C=l,b=m){c(a),g(C/a),L(I(b));const _=[];for(let n=0;n<=a;++n)_.push({x:b.x+C*n/a,y:b.y});x(_),p(_.map(I))}function t(a,C=!0){const b=u(),_=f();let n=S().map(I);n[b]=I(a);for(let e=b-1;e>=0;--e){const h=n[e+1].x-n[e].x,N=n[e+1].y-n[e].y,j=Math.hypot(h,N),s=_/j;n[e]={x:(1-s)*n[e+1].x+s*n[e].x,y:(1-s)*n[e+1].y+s*n[e].y}}if(C){n[0]=I($());for(let e=1;e<=b;++e){const h=n[e-1].x-n[e].x,N=n[e-1].y-n[e].y,j=Math.hypot(h,N),s=_/j;n[e]={x:(1-s)*n[e-1].x+s*n[e].x,y:(1-s)*n[e-1].y+s*n[e].y}}}x(n)}function o(){p(S().map(I))}function i(a){v(a,f()*a,$())}return v(r,l,m),{numSegments:u,setNumSegments:i,segLength:f,center:$,joints:S,shadowJoints:B,holdShadow:o,fabrik:t,setupChain:v}}const Z=te();function ae(){const[r,l]=F(10),[m,u]=F(!0),[c,f]=F(!0),[g,$]=F({x:400,y:300}),[L,S]=F(!1),[x,B]=F(!1),[p,v]=F(null),t=se();return{numSegments:r,setNumSegments:l,fixedBase:m,setFixedBase:u,shadow:c,setShadow:f,target:g,setTarget:$,fixedTarget:L,setFixedTarget:S,isCtrlPressed:x,setIsCtrlPressed:B,canvas:p,setCanvas:v,chain:t}}function ee(){const r=ne(Z);if(!r)throw new Error("FabrikContext missing");return r}var le=T("<svg width=600 height=600><polyline fill=none stroke=dodgerblue stroke-width=4></polyline><circle r=12 fill=blue stroke=red stroke-width=2 opacity=0.5>"),ce=T("<svg><polyline fill=none stroke=gray stroke-width=4 opacity=0.4></svg>",!1,!0,!1),de=T("<svg><line stroke=gray stroke-width=1 stroke-dasharray=4 opacity=0.5></svg>",!1,!0,!1),ue=T("<svg><circle r=8></svg>",!1,!0,!1);function fe(){const{numSegments:r,fixedBase:l,shadow:m,fixedTarget:u,target:c,setTarget:f,isCtrlPressed:g,setIsCtrlPressed:$,setCanvas:L,chain:S}=ee(),{joints:x,shadowJoints:B,fabrik:p,holdShadow:v}=S;let t,o=!1;function i(e){const h=t.getBoundingClientRect();return{x:e.clientX-h.left,y:e.clientY-h.top}}function a(e){const h=x()[r()],N=i(e);Math.abs(N.x-h.x)<20&&Math.abs(N.y-h.y)<20&&(o=!0,window.addEventListener("mousemove",C),window.addEventListener("mouseup",b))}function C(e){if(!o)return;const h=i(e);u()||(f({x:h.x,y:h.y}),p({x:h.x,y:h.y},l()))}function b(){o=!1,g()||v(),window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",b)}function _(e){e.key==="Control"&&($(!0),v())}function n(e){e.key==="Control"&&($(!1),v())}return Q(()=>{t&&L(t),window.addEventListener("keydown",_),window.addEventListener("keyup",n)}),W(()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",b),window.removeEventListener("keydown",_),window.removeEventListener("keyup",n)}),K(()=>{p(c(),l()),g()||v()}),K(()=>{p(c(),l()),v()}),(()=>{var e=le(),h=e.firstChild,N=h.nextSibling;e.$$mousedown=a;var j=t;return typeof j=="function"?J(j,e):t=e,z(e,"background","DimGray"),z(e,"display","block"),z(e,"margin","0 auto"),A(e,(()=>{var s=V(()=>!!m());return()=>s()&&[(()=>{var y=ce();return D(()=>k(y,"points",B().map(w=>`${w.x},${w.y}`).join(" "))),y})(),V(()=>B().map((y,w)=>{const d=x()[w];return Math.abs(y.x-d.x)<1&&Math.abs(y.y-d.y)<1?null:(()=>{var M=de();return D(E=>{var R=y.x,U=y.y,H=d.x,G=d.y;return R!==E.e&&k(M,"x1",E.e=R),U!==E.t&&k(M,"y1",E.t=U),H!==E.a&&k(M,"x2",E.a=H),G!==E.o&&k(M,"y2",E.o=G),E},{e:void 0,t:void 0,a:void 0,o:void 0}),M})()}))]})(),h),A(e,()=>x().map((s,y)=>(()=>{var w=ue();return D(d=>{var M=s.x,E=s.y,R=y===0?"blue":y===r()?"cyan":"black",U=y===r()?"red":"none",H=y===r()?2:0;return M!==d.e&&k(w,"cx",d.e=M),E!==d.t&&k(w,"cy",d.t=E),R!==d.a&&k(w,"fill",d.a=R),U!==d.o&&k(w,"stroke",d.o=U),H!==d.i&&k(w,"stroke-width",d.i=H),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),w})()),N),D(s=>{var y=x().map(M=>`${M.x},${M.y}`).join(" "),w=c().x,d=c().y;return y!==s.e&&k(h,"points",s.e=y),w!==s.t&&k(N,"cx",s.t=w),d!==s.a&&k(N,"cy",s.a=d),s},{e:void 0,t:void 0,a:void 0}),e})()}O(["mousedown"]);var he=T("<label><input type=checkbox> Fixed Base"),me=T("<label for=numSegs>Number of Segments: <output></output><input type=range id=numSegs min=1 max=30>"),ge=T("<label><input type=checkbox> Shadow"),ve=T("<label>Target: <input type=text size=7>"),ye=T("<label><input type=checkbox> Fixed Target"),xe=T("<button type=button>Save Image"),pe=T("<a download=FabrikDemo.svg hidden>");const q=r=>{const{numSegments:l,setNumSegments:m,fixedBase:u,setFixedBase:c,shadow:f,setShadow:g,target:$,setTarget:L,fixedTarget:S,setFixedTarget:x,canvas:B}=ee();let p,v;return P(oe,{get children(){return[P(X,{get when(){return r.position==="top"},get children(){return[(()=>{var t=he(),o=t.firstChild;return o.$$input=i=>c(i.currentTarget.checked),D(()=>o.checked=u()),t})(),"‚ÄÉ‚ÄÉ",(()=>{var t=me(),o=t.firstChild,i=o.nextSibling,a=i.nextSibling;return z(i,"display","inline-block"),z(i,"width","1em"),A(i,l),a.$$input=C=>m(Number(C.currentTarget.value)),z(a,"width","150px"),D(()=>a.value=l()),t})(),"‚ÄÉ",(()=>{var t=ge(),o=t.firstChild;return o.$$input=i=>g(i.currentTarget.checked),D(()=>o.checked=f()),t})()]}}),P(X,{get when(){return r.position==="bottom"},get children(){return[(()=>{var t=ve(),o=t.firstChild,i=o.nextSibling;i.$$input=C=>{const[b,_]=C.currentTarget.value.split(",").map(Number);!isNaN(b)&&!isNaN(_)&&L({x:b,y:_})};var a=v;return typeof a=="function"?J(a,i):v=i,D(()=>i.value=`${Math.round($().x)}, ${Math.round($().y)}`),t})(),"‚ÄÇ",(()=>{var t=ye(),o=t.firstChild;return o.$$input=i=>x(i.currentTarget.checked),D(()=>o.checked=S()),t})(),"‚ÄÉ‚ÄÉ",(()=>{var t=xe();return t.$$click=()=>{const o=B();if(!o){console.error("Canvas node not found!");return}let i=(u()?"-fixedBase":"")+(f()?"-shadow":"");p.download=`FabrikDemo-${l()}-${v.value.replace(" ","")}${i}.svg`;const a=new XMLSerializer().serializeToString(o);p.href="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a),p.click()},t})(),(()=>{var t=pe(),o=p;return typeof o=="function"?J(o,t):p=t,t})()]}})]}})};O(["input","click"]);const Y=":root{font-family:system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#242424;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}@media(prefers-color-scheme:light){:root{color:#213547;background-color:#fff}a:hover{color:#747bff}button{background-color:#f9f9f9}}";var be=T('<div style="max-width:800px;margin:10px auto 30px"><p>Instruction:</p><ul><li><b>Drag</b> the tip <span style=color:red>‚óâ</span> (red-circled end) to see the effect üòâ. This tip is the end effector which will (try to) follow the red-circled target.</li><li>Its base (the other end) can be released by unchecking ‚ÄúFixed Base‚Äù.</li><li>Number of segments: Increase to see smoother transformation; Decrease to see its mechanism, esp. the basic with a single segment.</li><li>The last position can be shown as a shadow chain (<a href=https://en.wikipedia.org/wiki/Ghosting_(television) target=_blank>ghost</a>) by checking ‚ÄúShadow‚Äù.</li><li>Hold <b>Ctrl</b> key down to keep the last position unchanged.</li><li>For more details, see the Explantion below.</li></ul><details style=margin-top:2em><summary>Explantion</summary><iframe width=100% height=100% style=border:0>');function we(r){let l,m;return Q(()=>{const u=document.querySelectorAll("style");u&&u.forEach(f=>{f.remove()});const c=document.createElement("style");c.textContent=Y,document.head.appendChild(c),W(()=>c.remove()),m.addEventListener("load",()=>{const f=m.contentDocument;if(f){const g=f.createElement("style");g.textContent=Y,f.head.appendChild(g)}}),ie(l,m)}),P(Z.Provider,{get value(){return ae()},get children(){var u=be(),c=u.firstChild,f=c.nextSibling,g=f.nextSibling,$=g.firstChild,L=$.nextSibling;A(u,P(q,{position:"top"}),c),A(u,P(fe,{}),c),A(u,P(q,{position:"bottom"}),c);var S=l;typeof S=="function"?J(S,g):l=g;var x=m;return typeof x=="function"?J(x,L):m=L,D(()=>k(L,"src",r.explanationUrl||"../FabrikExplanation.html")),u}})}class ke extends HTMLElement{connectedCallback(){const l=this.attachShadow({mode:"open"}),m=this.getAttribute("explanation-url")||void 0;re(()=>P(we,{explanationUrl:m}),l)}disconnectedCallback(){}}customElements.define("fabrik-demo-solid-svg",ke);export{we as F};
